# Fail2ban jail configuration
# Managed by Ansible

[DEFAULT]
# Ban duration in seconds (1 hour)
bantime = {{ fail2ban_bantime | default(3600) }}

# Time window for counting retries (10 minutes)
findtime = {{ fail2ban_findtime | default(600) }}

# Number of failures before ban
maxretry = {{ fail2ban_maxretry | default(5) }}

# IPs to never ban (localhost + configured whitelist)
ignoreip = 127.0.0.1/8 ::1{% if fail2ban_ignoreip is defined and fail2ban_ignoreip | length > 0 %} {{ fail2ban_ignoreip | join(' ') }}{% endif %}

# Default action using ufw
banaction = ufw
banaction_allports = ufw

# Email notifications (optional)
{% if fail2ban_destemail is defined %}
destemail = {{ fail2ban_destemail }}
sendername = Fail2Ban
action = %(action_mwl)s
{% endif %}

[sshd]
enabled = true
port = {{ ssh_port | default(22) }}
logpath = %(sshd_log)s
backend = %(sshd_backend)s
maxretry = {{ fail2ban_ssh_maxretry | default(fail2ban_maxretry) | default(5) }}
bantime = {{ fail2ban_ssh_bantime | default(fail2ban_bantime) | default(3600) }}
findtime = {{ fail2ban_ssh_findtime | default(fail2ban_findtime) | default(600) }}
