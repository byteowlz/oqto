# Fail2ban Configuration
# Generated by Ansible

[DEFAULT]
# Ban duration
bantime = {{ fail2ban_bantime | default(3600) }}

# Time window for counting failures
findtime = {{ fail2ban_findtime | default(600) }}

# Number of failures before ban
maxretry = {{ fail2ban_maxretry | default(5) }}

# Ignore localhost and whitelisted IPs
ignoreip = 127.0.0.1/8 ::1{% if fail2ban_ignoreip is defined and fail2ban_ignoreip | length > 0 %} {{ fail2ban_ignoreip | join(' ') }}{% endif %}

# Default action
banaction = ufw
banaction_allports = ufw

{% if fail2ban_destemail is defined %}
# Email notifications
destemail = {{ fail2ban_destemail }}
sender = fail2ban@{{ ansible_hostname }}
action = %(action_mwl)s
{% endif %}

[sshd]
enabled = true
port = {{ ssh_port | default(22) }}
filter = sshd
{% if ansible_facts['os_family'] == 'Debian' %}
logpath = %(sshd_log)s
backend = systemd
{% else %}
logpath = /var/log/auth.log
{% endif %}
maxretry = {{ fail2ban_ssh_maxretry | default(fail2ban_maxretry) | default(5) }}
bantime = {{ fail2ban_ssh_bantime | default(fail2ban_bantime) | default(3600) }}
findtime = {{ fail2ban_ssh_findtime | default(fail2ban_findtime) | default(600) }}
