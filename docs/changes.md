# Changes

- 2026-01-26: Align Main Chat (Pi) message rendering with OpenCode cards and merge Pi tool results with tool calls for consistent display.
- 2026-01-26: Show OpenCode-style loading skeletons in Main Chat while Pi chat connects.
- 2026-01-26: Fix Main Chat crash caused by referencing displayError before initialization.
- 2026-01-26: Match Main Chat file reference cards to OpenCode and strip dagger-style suffixes from @file references for preview headers.
- 2026-01-25: Retry OpenCode sessions on WS subscribe when opencode is unhealthy and only treat local sessions as running when all core ports are bound.
- 2026-01-25: Attach session IDs to WebSocket command errors so OpenCode failures surface in the chat UI.
- 2026-01-25: Show a toast when OpenCode message sends fail in the session screen.
- 2026-01-26: Emit session error events when OpenCode message updates include error payloads so UI toasts always appear.
- 2026-01-25: Create a TRX epic with performance hotspots and remediation steps for UI handler violations.
- 2026-01-25: Restrict auth token query parameters to WebSocket-only endpoints.
- 2026-01-25: Cap zip downloads by total bytes and entry count in octo-files.
- 2026-01-21: Sidebar session search now filters Main Chat entries and counts Main Chat matches in results.
- 2026-01-21: Improved chat session selection stability, Main Chat sidebar refresh, and file upload handling.
- 2026-01-21: Added a rotating segment ring around stop buttons in Main Chat and OpenCode sessions.
- 2026-01-21: Refresh OpenCode chat messages on part.* SSE events to reduce missing updates.
- 2026-01-22: Fix idle session cleanup by normalizing activity timestamps in idle queries.
- 2026-01-22: Add a longer gradient-glow segment that moves along the stop button outline.
- 2026-01-22: Force fresh message fetches on event-driven refreshes to avoid stale cache.
- 2026-01-22: Remove legacy session event mapping and use WsEvent directly in chat UI.
- 2026-01-22: Normalize stop/send button padding so icon spacing matches other controls.
- 2026-01-22: Allow resuming active Main Chat sessions before a session file exists on disk.
- 2026-01-22: Drop optimistic Main Chat messages once matching server history arrives to avoid duplicates.
- 2026-01-22: Return closed TRX issues in the API and add a closed-only filter in the TRX view.
- 2026-01-22: Sort OpenCode session messages by creation time to prevent out-of-order display.
- 2026-01-22: Use the last active OpenCode base URL and session when aborting so stop works after resume.
- 2026-01-22: Avoid mmry port collisions by including mmry in session port allocation and conflict checks.
- 2026-01-22: Stop and replace stale OpenCode SSE adapters to prevent rapid reconnect loops.
- 2026-01-22: Serialize session port allocation to avoid mmry port unique constraint conflicts.
- 2026-01-22: Allow setup.sh sudoers generation to support linux user creation with useradd flags, group creation, and workspace ownership updates.
- 2026-01-22: Sanitize linux user GECOS comments to avoid useradd failures on colon characters.
- 2026-01-22: Use the first dev user as the default session user in dev mode for local sessions.
- 2026-01-22: Resolve local runtime binaries to absolute paths before spawning under sudo.
- 2026-01-22: Prefer sudo over su when spawning ttyd shells to avoid su option errors.
- 2026-01-22: Fix ttyd shell args to pass each argument separately instead of as a joined string.
- 2026-01-22: Spawn per-user mmry instances in multi-user mode for isolated memory stores.
- 2026-01-27: Invalidate Main Chat Pi message caches after tool-call/result merge changes and strip Pi citation tokens like 【...†L...】 before markdown rendering.
- 2026-01-27: Prefer stored readable IDs in session UI and persist readable_id in session records.
- 2026-01-27: Add optional hstry-backed chat history reads when a hstry.db is available.
- 2026-01-28: Install hstry via `just install` so Octo setups include the hstry CLI.
- 2026-01-28: Fix session insert SQL placeholder count so workspace IO sessions can be created.
