# Example configuration for Octo server.
# Copy this file to $XDG_CONFIG_HOME/octo/config.toml and adjust as needed.

"$schema" = "https://raw.githubusercontent.com/byteowlz/schemas/refs/heads/main/octo/octo.backend.config.schema.json"

profile = "default"

[logging]
# Valid levels: error, warn, info, debug, trace
level = "info"
# Optional path for log file output; supports ~ and environment variables.
# file = "~/Library/Logs/octo.log"

[runtime]
# Override the worker pool size; defaults to logical CPU count when unset.
# parallelism = 8
# Timeout in seconds for long-running operations.
timeout = 60
fail_fast = true

[paths]
# Uncomment to move persistent data/state to custom directories.
# data_dir = "$XDG_DATA_HOME/octo"
# state_dir = "$XDG_STATE_HOME/octo"

[container]
# Container runtime: "docker" or "podman" (auto-detected if not specified)
# runtime = "docker"
# Custom path to the container runtime binary (optional)
# binary = "/usr/local/bin/docker"
# Default container image for sessions
default_image = "octo-dev:latest"
# Base port for allocating session ports (each session uses 3 consecutive ports)
base_port = 41820
# Path to skeleton directory for new user homes (dotfiles, configs, etc.)
# When a new user session is created, this directory is copied as the user's home.
# skel_path = "./container/skel"

[local]
# Local mode configuration - run without containers
# Useful for Proxmox LXC, bare-metal, or development without Docker
# Enable with --local-mode CLI flag or set enabled = true here
enabled = false

# Path to the opencode binary (must be installed on the host)
opencode_binary = "opencode"
# Path to the fileserver binary (from this repo's fileserver/ directory)
fileserver_binary = "fileserver"
# Path to the ttyd binary (install via package manager or from https://tsl0922.github.io/ttyd/)
ttyd_binary = "ttyd"

# Base directory for user workspaces in local mode.
# Supports ~ and environment variables.
# The {user_id} placeholder is replaced with the user ID in multi-user mode.
# In single_user mode, {user_id} is ignored and the base path is used directly.
# Examples:
#   Multi-user: "$HOME/octo/{user_id}" -> /home/alice/octo/alice, /home/alice/octo/bob
#   Single-user: "$HOME/octo/{user_id}" -> /home/alice/octo (ignores {user_id})
#   Single-user: "$HOME/workspace" -> /home/alice/workspace
workspace_dir = "$HOME/octo/{user_id}"

# Persona configuration - point opencode at a custom persona directory.
# A "persona" is a directory with AGENTS.md, opencode.json, and other config files
# that define how opencode behaves for a specific project or use case.
#
# personas_path: Base directory where persona directories live.
# default_persona: Name of the persona subdirectory to use.
#
# When both are set, opencode runs with its working directory set to:
#   {personas_path}/{default_persona}
#
# This allows you to have multiple personas in one location:
#   ~/byteowlz/govnr/    <- govnr persona with its own AGENTS.md
#   ~/byteowlz/octo/     <- octo persona
#   ~/byteowlz/myapp/    <- another project's persona
#
# Supports ~ and environment variables.
# personas_path = "~/byteowlz"
# default_persona = "govnr"

# Enable single-user mode for personal/single-user deployments.
# When true:
#   - The {user_id} placeholder in workspace_dir is ignored
#   - All sessions use the same workspace directory
#   - Password protection is still available
# When false (default):
#   - Each user gets their own workspace directory
#   - Multi-tenancy is supported
single_user = false

# Use shared runner sockets so the backend can connect as non-root.
runner_socket_pattern = "/run/octo/runner-sockets/{user}/octo-runner.sock"

# Preserve running sessions across backend restarts.
# When false, Octo will skip startup port cleanup to avoid killing running
# opencode/fileserver/ttyd processes.
cleanup_on_startup = false
# When false, Octo will NOT stop local sessions on shutdown.
stop_sessions_on_shutdown = false

# Runner socket path pattern for per-user `octo-runner` daemons.
# Supports `{user}` (Linux username) and `{uid}`.
#
# This is required for features that spawn per-user processes via the runner
# (e.g. per-user mmry in local multi-user mode).
# runner_socket_pattern = "/run/octo/runner-sockets/{user}/octo-runner.sock"

# Linux user isolation for multi-user deployments
# Creates a dedicated Linux user per platform user for process isolation.
# Requires root/sudo privileges for user creation.
# Ignored when single_user = true.
[local.linux_users]
# Enable Linux user isolation (requires root/sudo)
enabled = false
# Prefix for created Linux usernames (e.g., "octo_" -> "octo_alice")
prefix = "octo_"
# Starting UID for created users (subsequent users get uid_start + 1, + 2, etc.)
uid_start = 2000
# Shared group for all octo users (created if it doesn't exist)
group = "octo"
# Shell for created users
shell = "/bin/bash"
# Use sudo for privilege escalation (set to false if running as root)
use_sudo = true
# Create home directories for users (recommended)
create_home = true

# Note: Sandbox configuration is in a SEPARATE file: ~/.config/octo/sandbox.toml
# This separation allows agents to modify config.toml (e.g., session preferences)
# while preventing them from weakening their own security restrictions.
# See examples/sandbox.toml for sandbox configuration options.

# Runner configuration for user-plane isolation.
# The runner daemon (octo-runner) reads this section to locate user data.
[runner]
# Directory containing Pi session files (for main chat history).
# Defaults to $XDG_DATA_HOME/pi/sessions (~/.local/share/pi/sessions)
# pi_sessions_dir = "~/.local/share/pi/sessions"

# Directory containing memories (mmry database).
# Defaults to $XDG_DATA_HOME/mmry (~/.local/share/mmry)
# memories_dir = "~/.local/share/mmry"

[agent_browser]
# Enable per-session agent-browser daemon management.
enabled = false
# Path to the agent-browser CLI binary.
binary = "agent-browser"
# Launch headed browser windows instead of headless.
headed = false
# Base port for screencast WebSocket streams.
stream_port_base = 30000
# Port range size for per-session streams.
stream_port_range = 10000
# Optional Chromium executable path.
# executable_path = "/usr/bin/chromium"
# Optional extensions to load (absolute paths).
# extensions = ["/path/to/extension"]

[eavs]
# EAVS (LLM proxy) configuration - runs on host, not in containers
# Enable EAVS integration for session virtual keys
enabled = true
# URL of the EAVS server (accessible from host)
base_url = "http://localhost:41800"
# URL for containers to reach EAVS (via Docker host networking)
# For Docker: http://host.docker.internal:41800
# For Podman (4.1+): http://host.containers.internal:41800
container_url = "http://host.containers.internal:41800"
# Master key for EAVS admin operations (create/revoke keys)
# IMPORTANT: Change this in production! Can also be set via EAVS_MASTER_KEY env var.
# master_key = "your-master-key-here"
# Default session budget limit in USD (optional)
default_session_budget_usd = 10.0
# Default session rate limit in requests per minute (optional)
default_session_rpm = 60

[auth]
# Enable development mode (uses dev_users for authentication, relaxed security)
# Set to false for production deployments
dev_mode = true

# JWT secret for signing tokens (REQUIRED when dev_mode = false)
# Must be at least 32 characters. Generate with: openssl rand -base64 48
# Can be a literal value or reference an environment variable with env: prefix
# jwt_secret = "your-secure-secret-at-least-32-characters-long"
# jwt_secret = "env:AUTH_JWT_SECRET"  # Reads from AUTH_JWT_SECRET environment variable

# OIDC configuration (optional, for external auth providers)
# oidc_issuer = "https://your-auth-provider.com"
# oidc_audience = "your-app-id"

# CORS allowed origins (defaults to localhost:3000 and localhost:8080 in dev mode)
# allowed_origins = ["https://your-domain.com"]

# Development users (only used when dev_mode = true)
# These are created with bcrypt-hashed passwords at startup
# [[auth.dev_users]]
# id = "dev"
# name = "Developer"
# email = "dev@localhost"
# password_hash = "$2b$12$..." # Use htpasswd -nbBC 12 username password | cut -d: -f2
# role = "admin"

[sessions]
# Auto-attach behavior when opening chat history:
# "off": never auto-attach
# "attach": attach only if a session is already running
# "resume": start/resume a session if none is running (resource-heavy)
auto_attach = "on"
# Scan running sessions for the selected chat session ID before attaching.
auto_attach_scan = true
# Maximum concurrent running sessions per user.
max_concurrent_sessions = 6
# Idle timeout in minutes before stopping a session.
idle_timeout_minutes = 30
# Idle cleanup check interval in seconds.
idle_check_interval_seconds = 300

[templates]
# Project templates repository (local clone on host).
# repo_path = "/path/to/octo-templates"
# Repository type: "remote" (git) or "local" (filesystem).
type = "remote"
# Sync templates repository before listing/creating.
sync_on_list = true
# Minimum seconds between sync attempts.
sync_interval_seconds = 120

[scaffold]
# Agent scaffolding configuration - defines the tool used to create new agent directories
# from templates. By default uses "byt new" but can be configured for any scaffolding tool.

# Binary to use for scaffolding
binary = "byt"
# Subcommand to invoke (e.g., "new" for "byt new <name>")
subcommand = "new"
# Argument for template name
template_arg = "--template"
# Argument for output directory
output_arg = "--output"
# Argument to create GitHub repo (optional, set to empty string to disable)
github_arg = "--github"
# Argument to make repo private (optional)
private_arg = "--private"
# Argument for description (optional)
description_arg = "--description"

# Example for cookiecutter:
# [scaffold]
# binary = "cookiecutter"
# subcommand = ""
# template_arg = ""
# output_arg = "-o"
# github_arg = ""
# private_arg = ""
# description_arg = ""
